require.paths.unshift('./node_modules');

var env = JSON.parse(process.env.VCAP_SERVICES);

/* Mongo Variables */
var mongo = env['mongodb-1.8'][0]['credentials'];
var mongourl = "mongo://" + mongo.username + ":" + mongo.password + "@" + mongo.hostname + ":" + mongo.port + "/" + mongo.db + "?auto_reconnect=true";

var Db = require('mongodb').Db,
  Connection = require('mongodb').Connection,
  Server = require('mongodb').Server,
  BSON = require('mongodb').BSONNative;

var db = new Db('visits', new Server(mongo.hostname, mongo.port) );

var port = (process.env.VMC_APP_PORT || 3000);
var host = (process.env.VCAP_APP_HOST || 'localhost');
var http = require('http');

db.open(function(err, conn) {
  db.authenticate(mongo.username, mongo.password, function(err, success) {

    http.createServer(function (req, res) {
      res.writeHead(200, {'Content-Type': 'text/plain'});
      res.end(mongourl+'\n');
    }).listen(port, host);

  }
});
